---

- name: deploy openstack infrastructure

  hosts: localhost
  gather_facts: False

  vars_files:
    - settings.yaml

  vars:
    tf_path: "./tf"

  tasks:

    - name: deploy
      register: tf_result
      community.general.terraform:
        project_path: "{{ tf_path }}"
        state: planned
        #state: present
        #state: absent
        plan_file: plan
        complex_vars: true
        variables:
          instances: "{{ instances }}"
          base_name: "{{ lasair_name }}"
          share_size: "{{ share_size }}"
          share_user: "{{ os.share_user }}"
          share_network: "{{ os.share_network_name }}"
          extra_networks:
            - "{{ os.share_network_name }}"

    - name: get_result
      ansible.builtin.debug:
        #msg: "{{ tf_result.outputs }}"
        msg: "{{ tf_result }}"


